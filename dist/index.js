"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs");var Formats;!function(t){t.APNG="apng",t.GIF="gif",t.MP4="mp4",t.WEBM="webm"}(Formats||(Formats={}));const action=async t=>{let e,o;t.setProgress("Authenticating…");try{const o="https://api.gfycat.com/v1/oauth/token",a=await t.request(o,{body:JSON.stringify({client_id:t.config.get("clientId"),client_secret:t.config.get("clientSecret"),grant_type:"client_credentials"}),headers:{"Content-Type":"application/json"},method:"post"});({access_token:e}=JSON.parse(a.body))}catch{return t.notify("There was a problem authenticating your account. Is your API info up to date?"),void t.cancel()}t.setProgress("Finding a place to upload…");try{const a="https://api.gfycat.com/v1/gfycats",s=await t.request(a,{headers:{Authorization:`Bearer ${e}`},method:"post"});({gfyname:o}=JSON.parse(s.body))}catch{return t.notify("There was a problem communicating with gfycat ☹️"),void t.cancel()}const a=await t.filePath();t.setProgress("Uploading…");try{const e=`https://filedrop.gfycat.com/${o}`;await t.request(e,{body:fs.createReadStream(a),method:"put"}),t.copyToClipboard(`https://gfycat.com/${o.toLowerCase()}`),t.notify("The URL to the upload has been copied to the clipboard"),t.notify("But gfycat is still processing the upload… ⏱")}catch{return t.notify("There was a problem uploading the recording"),void t.cancel()}t.setProgress("Processing on gfycat…");try{const e=t=>new Promise(e=>setTimeout(e,t)),a=1e3,s=120,c=Date.now()+a*s;let i="encoding";for(;"encoding"===i&&Date.now()<c;){const s=4;await e(a*s);const c=`https://api.gfycat.com/v1/gfycats/fetch/status/${o}`,n=await t.request(c);({task:i}=JSON.parse(n.body))}switch(i){case"complete":t.notify("gfycat has finished processing the upload");break;case"encoding":return t.notify(`gfycat has taken longer than ${s} seconds to process the upload`),void t.notify(`See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${o}`);default:throw new Error}}catch{t.copyToClipboard(`https://api.gfycat.com/v1/gfycats/fetch/status/${o}`),t.notify(`There was a problem processing the uploaded file. See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${o}`),t.cancel()}},config={clientId:{default:"",description:"This is your `client_id`.",required:!0,title:"API Key",type:"string"},clientSecret:{default:"",description:"This is your `client_secret`.",required:!0,title:"API Secret",type:"string"}},gfycat={action:action,config:config,configDescription:"You can sign up for an API key at https://developers.gfycat.com/signup/#/apiform and find more info about the API at https://developers.gfycat.com/api/.",formats:[Formats.GIF,Formats.MP4],title:"Share to gfycat"};exports.shareServices=[gfycat];