"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const gfycat_api_js_1=require("./gfycat-api.js");var Formats;!function(t){t.APNG="apng",t.GIF="gif",t.MP4="mp4",t.WEBM="webm"}(Formats||(Formats={}));const action=async t=>{const e=e=>{t.notify(e),t.cancel()},a=new gfycat_api_js_1.GfycatApi(t.config.get("clientId"),t.config.get("clientSecret"));t.setProgress("Authenticating…");try{await a.authenticate()}catch{return void e("There was a problem authenticating your account. Is your API info up to date?")}let o;t.setProgress("Finding a place to upload…");try{o=await a.getUploadId()}catch{return void e("There was a problem communicating with gfycat ☹️")}const i=await t.filePath();t.setProgress("Uploading…");try{await a.uploadFile(i),t.copyToClipboard(`https://gfycat.com/${o.toLowerCase()}`),t.notify("The URL to the upload has been copied to the clipboard"),t.notify("But gfycat is still processing the upload… ⏱")}catch{return void e("There was a problem uploading the recording")}t.setProgress("Processing on gfycat…");try{const e=t=>new Promise(e=>setTimeout(e,t)),i=1e3,c=120,s=Date.now()+i*c;let n="encoding";for(;"encoding"===n&&Date.now()<s;){const t=4;await e(i*t);const o=await a.checkUploadStatus();({task:n}=o)}switch(n){case"complete":t.notify("gfycat has finished processing the upload");break;case"encoding":return t.notify(`gfycat has taken longer than ${c} seconds to process the upload`),void t.notify(`See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${o}`);default:throw new Error}}catch{t.copyToClipboard(`https://api.gfycat.com/v1/gfycats/fetch/status/${o}`),e(`There was a problem processing the uploaded file. See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${o}`)}},config={clientId:{default:"",description:"This is your `client_id`.",required:!0,title:"API Key",type:"string"},clientSecret:{default:"",description:"This is your `client_secret`.",required:!0,title:"API Secret",type:"string"}};exports.shareServices=[{action:action,config:config,configDescription:"You can sign up for an API key at https://developers.gfycat.com/signup/#/apiform and find more info about the API at https://developers.gfycat.com/api/.",formats:[Formats.GIF,Formats.MP4],title:"Share to gfycat"}];