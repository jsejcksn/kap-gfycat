"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs");var Formats;!function(t){t.APNG="apng",t.GIF="gif",t.MP4="mp4",t.WEBM="webm"}(Formats||(Formats={}));const action=async t=>{let e,o;t.setProgress("Authenticating…");try{const o="https://api.gfycat.com/v1/oauth/token",a=await t.request(o,{body:JSON.stringify({client_id:t.config.get("clientId"),client_secret:t.config.get("clientSecret"),grant_type:"client_credentials"}),headers:{"Content-Type":"application/json"},method:"post"});({access_token:e}=JSON.parse(a.body))}catch(e){return t.notify("There was a problem authenticating your account. Is your API info up to date?"),void t.cancel()}t.setProgress("Finding a place to upload…");try{const a="https://api.gfycat.com/v1/gfycats",c=await t.request(a,{headers:{Authorization:`Bearer ${e}`},method:"post"});({gfyname:o}=JSON.parse(c.body))}catch(e){return t.notify("There was a problem communicating with gfycat ☹️"),void t.cancel()}const a=await t.filePath();t.setProgress("Uploading…");try{const e=`https://filedrop.gfycat.com/${o}`;await t.request(e,{body:fs.createReadStream(a),method:"put"}),t.notify("Upload complete. Waiting for gfycat to process the recording… ⏱")}catch(e){return t.notify("There was a problem uploading the recording"),void t.cancel()}t.setProgress("Processing on gfycat…");try{const e=t=>new Promise(e=>setTimeout(e,t)),a=1e3,c=60,s=Date.now()+a*c;let i="encoding";for(;"encoding"===i&&Date.now()<s;){const c=4;await e(a*c);const s=`https://api.gfycat.com/v1/gfycats/fetch/status/${o}`,r=await t.request(s);({task:i}=JSON.parse(r.body))}switch(i){case"complete":t.copyToClipboard(`https://gfycat.com/${o.toLowerCase()}`),t.notify("The URL to the upload has been copied to the clipboard");break;case"encoding":return t.copyToClipboard(`https://gfycat.com/${o.toLowerCase()}`),void t.notify("gfycat is still processing the upload, but its URL has been copied to the clipboard anyway.");default:throw new Error}}catch(e){t.copyToClipboard(`https://api.gfycat.com/v1/gfycats/fetch/status/${o}`),t.notify(`There was a problem processing the uploaded file. See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${o}`),t.cancel()}},config={clientId:{default:"",required:!0,title:"client_id / API key",type:"string"},clientSecret:{default:"",required:!0,title:"client_secret",type:"string"}},gfycat={action:action,config:config,configDescription:"You can get the required information at https://developers.gfycat.com/signup/#/apiform",formats:[Formats.GIF,Formats.MP4],title:"Share to gfycat"};exports.shareServices=[gfycat];