"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs");var Formats;!function(t){t.APNG="apng",t.GIF="gif",t.MP4="mp4",t.WEBM="webm"}(Formats||(Formats={}));const action=async t=>{let e,a;t.setProgress("Authenticating…");try{const a="https://api.gfycat.com/v1/oauth/token",o=await t.request(a,{body:JSON.stringify({client_id:t.config.get("clientId"),client_secret:t.config.get("clientSecret"),grant_type:"client_credentials"}),headers:{"Content-Type":"application/json"},method:"post"});({access_token:e}=JSON.parse(o.body))}catch(e){return t.notify("There was a problem authenticating your account. Is your API info up to date?"),void t.cancel()}t.setProgress("Finding a place to upload…");try{const o="https://api.gfycat.com/v1/gfycats",c=await t.request(o,{headers:{Authorization:`Bearer ${e}`},method:"post"});({gfyname:a}=JSON.parse(c.body))}catch(e){return t.notify("There was a problem communicating with gfycat ☹️"),void t.cancel()}const o=await t.filePath();t.setProgress("Uploading…");try{const e=`https://filedrop.gfycat.com/${a}`;await t.request(e,{body:fs.createReadStream(o),method:"put"}),t.copyToClipboard(`https://gfycat.com/${a.toLowerCase()}`),t.notify("The URL to the upload has been copied to the clipboard"),t.notify("But gfycat is still processing the upload… ⏱")}catch(e){return t.notify("There was a problem uploading the recording"),void t.cancel()}t.setProgress("Processing on gfycat…");try{const e=t=>new Promise(e=>setTimeout(e,t)),o=1e3,c=120,s=Date.now()+o*c;let i="encoding";for(;"encoding"===i&&Date.now()<s;){const c=4;await e(o*c);const s=`https://api.gfycat.com/v1/gfycats/fetch/status/${a}`,n=await t.request(s);({task:i}=JSON.parse(n.body))}switch(i){case"complete":t.notify("gfycat has finished processing the upload");break;case"encoding":return t.notify(`gfycat has taken longer than ${c} seconds to process the upload`),void t.notify(`See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${a}`);default:throw new Error}}catch(e){t.copyToClipboard(`https://api.gfycat.com/v1/gfycats/fetch/status/${a}`),t.notify(`There was a problem processing the uploaded file. See the status at https://api.gfycat.com/v1/gfycats/fetch/status/${a}`),t.cancel()}},config={clientId:{default:"",required:!0,title:"client_id / API key",type:"string"},clientSecret:{default:"",required:!0,title:"client_secret",type:"string"}},gfycat={action:action,config:config,configDescription:"You can get the required information at https://developers.gfycat.com/signup/#/apiform",formats:[Formats.GIF,Formats.MP4],title:"Share to gfycat"};exports.shareServices=[gfycat];